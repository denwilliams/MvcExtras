See comments in code.

Documentation coming soon.